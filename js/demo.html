<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniMask Utils æµ‹è¯•ç¤ºä¾‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        h2 {
            color: #667eea;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .demo-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
        }
        
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }
        
        .result-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .result-content {
            font-family: monospace;
            color: #333;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.encrypted {
            background: #ffe0b2;
            color: #e65100;
        }
        
        .status.plain {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ UniMask Utils å·¥å…·æµ‹è¯•</h1>
        <p class="subtitle">å‰ç«¯åŠ å¯†æ–‡æœ¬æ£€æµ‹å’Œå¤„ç†å·¥å…·æ¼”ç¤º</p>
        
        <!-- ç¤ºä¾‹ 1: åŸºæœ¬æ£€æµ‹ -->
        <h2>1ï¸âƒ£ åŸºæœ¬æ£€æµ‹åŠŸèƒ½</h2>
        <div class="demo-section">
            <div class="demo-title">æ£€æµ‹æ–‡æœ¬æ˜¯å¦åŒ…å«åŠ å¯†å­—ç¬¦</div>
            <div class="input-group">
                <label>è¾“å…¥æµ‹è¯•æ–‡æœ¬ï¼š</label>
                <input type="text" id="testText1" value="å¼ ä¼Ÿæ˜" placeholder="ä¾‹å¦‚ï¼šå¼ ä¼Ÿæ˜">
            </div>
            <button onclick="testIsEncrypted()">æ£€æµ‹</button>
            <button onclick="setEncryptedText1()">ä½¿ç”¨åŠ å¯†ç¤ºä¾‹</button>
            <div class="result" id="result1" style="display: none;">
                <div class="result-label">æ£€æµ‹ç»“æœï¼š</div>
                <div class="result-content" id="resultContent1"></div>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹ 2: å­—ç¬¦æ›¿æ¢ -->
        <h2>2ï¸âƒ£ å­—ç¬¦æ›¿æ¢åŠŸèƒ½</h2>
        <div class="demo-section">
            <div class="demo-title">å°†åŠ å¯†å­—ç¬¦æ›¿æ¢ä¸ºæ˜Ÿå·</div>
            <div class="input-group">
                <label>è¾“å…¥åŠ å¯†æ–‡æœ¬ï¼š</label>
                <input type="text" id="testText2" value="" placeholder="ä¾‹å¦‚ï¼šå¼ \uE123\uE456">
            </div>
            <div class="input-group">
                <label>æ›¿æ¢å­—ç¬¦ï¼š</label>
                <input type="text" id="replacement" value="*" placeholder="é»˜è®¤ä¸º *" style="width: 100px;">
            </div>
            <button onclick="testReplace()">æ›¿æ¢</button>
            <button onclick="setEncryptedText2()">ä½¿ç”¨åŠ å¯†ç¤ºä¾‹</button>
            <div class="result" id="result2" style="display: none;">
                <div class="result-label">æ›¿æ¢ç»“æœï¼š</div>
                <div class="result-content" id="resultContent2"></div>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹ 3: æ–‡æœ¬åˆ†æ -->
        <h2>3ï¸âƒ£ æ–‡æœ¬åˆ†æåŠŸèƒ½</h2>
        <div class="demo-section">
            <div class="demo-title">åˆ†ææ–‡æœ¬çš„åŠ å¯†æƒ…å†µ</div>
            <div class="input-group">
                <label>è¾“å…¥æ–‡æœ¬ï¼š</label>
                <input type="text" id="testText3" value="" placeholder="ä¾‹å¦‚ï¼šå¼ \uE123\uE456">
            </div>
            <button onclick="testAnalyze()">åˆ†æ</button>
            <button onclick="setEncryptedText3()">ä½¿ç”¨åŠ å¯†ç¤ºä¾‹</button>
            <div class="result" id="result3" style="display: none;">
                <div class="result-label">åˆ†æç»“æœï¼š</div>
                <div class="result-content" id="resultContent3"></div>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹ 4: æ‰¹é‡å¤„ç†å¯¹è±¡ -->
        <h2>4ï¸âƒ£ æ‰¹é‡å¤„ç†å¯¹è±¡</h2>
        <div class="demo-section">
            <div class="demo-title">å¤„ç†å¯¹è±¡ä¸­çš„åŠ å¯†å­—æ®µ</div>
            <div class="code-block">const user = {
    id: 1,
    name: "å¼ \uE123\uE456",
    phone: "138\uE234\uE345\uE456\uE567",
    email: "test@example.com"
};</div>
            <button onclick="testObjectReplace()">å¤„ç†å¯¹è±¡</button>
            <div class="result" id="result4" style="display: none;">
                <div class="result-label">å¤„ç†ç»“æœï¼š</div>
                <div class="result-content" id="resultContent4"></div>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹ 5: æ‰¹é‡å¤„ç†æ•°ç»„ -->
        <h2>5ï¸âƒ£ æ‰¹é‡å¤„ç†æ•°ç»„</h2>
        <div class="demo-section">
            <div class="demo-title">å¤„ç†æ•°ç»„ä¸­æ‰€æœ‰å¯¹è±¡çš„åŠ å¯†å­—æ®µï¼ˆæ¨¡æ‹Ÿæ•°æ®å¯¼å‡ºï¼‰</div>
            <button onclick="testArrayReplace()">å¤„ç†æ•°ç»„</button>
            <div class="result" id="result5" style="display: none;">
                <div class="result-label">åŸå§‹æ•°æ®ï¼š</div>
                <table id="originalTable"></table>
                <div class="result-label" style="margin-top: 20px;">å¤„ç†åæ•°æ®ï¼ˆå¯å¯¼å‡ºï¼‰ï¼š</div>
                <table id="processedTable"></table>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹ 6: å¯¼å‡ºæ ¼å¼è½¬æ¢ -->
        <h2>6ï¸âƒ£ å¯¼å‡ºæ ¼å¼è½¬æ¢</h2>
        <div class="demo-section">
            <div class="demo-title">è½¬æ¢ä¸ºå¯å¯¼å‡ºæ ¼å¼ï¼ˆç”¨äº CSVã€Excelï¼‰</div>
            <div class="input-group">
                <label>è¾“å…¥åŠ å¯†æ–‡æœ¬ï¼š</label>
                <textarea id="testText6" placeholder="ä¾‹å¦‚ï¼šå¼ \uE123\uE456\næ\uE234\uE567"></textarea>
            </div>
            <button onclick="testExportFormat(true)">ä¿æŒé•¿åº¦</button>
            <button onclick="testExportFormat(false)">åˆå¹¶æ˜Ÿå·</button>
            <button onclick="setEncryptedText6()">ä½¿ç”¨ç¤ºä¾‹</button>
            <div class="result" id="result6" style="display: none;">
                <div class="result-label">è½¬æ¢ç»“æœï¼š</div>
                <div class="result-content" id="resultContent6"></div>
            </div>
        </div>
    </div>
    
    <script src="unimask-utils.js"></script>
    <script>
        // ç”Ÿæˆæµ‹è¯•ç”¨çš„åŠ å¯†å­—ç¬¦
        function generateEncryptedText(plainText, preserveCount) {
            let result = '';
            for (let i = 0; i < plainText.length; i++) {
                if (i < preserveCount) {
                    result += plainText[i];
                } else {
                    // ä½¿ç”¨ PUA åŒºçš„éšæœºå­—ç¬¦
                    const pua = 0xE000 + Math.floor(Math.random() * 0x800);
                    result += String.fromCharCode(pua);
                }
            }
            return result;
        }
        
        // ç¤ºä¾‹ 1: æ£€æµ‹
        function testIsEncrypted() {
            const text = document.getElementById('testText1').value;
            const isEncrypted = UniMaskUtils.isEncrypted(text);
            const count = UniMaskUtils.countEncryptedChars(text);
            
            const status = isEncrypted ? 'encrypted' : 'plain';
            const statusText = isEncrypted ? 'åŒ…å«åŠ å¯†å­—ç¬¦' : 'çº¯æ˜æ–‡';
            
            document.getElementById('resultContent1').innerHTML = `
                <div>
                    <strong>æ–‡æœ¬ï¼š</strong>${text} 
                    <span class="status ${status}">${statusText}</span>
                </div>
                <div style="margin-top: 10px;">
                    <strong>åŠ å¯†å­—ç¬¦æ•°é‡ï¼š</strong>${count}
                </div>
            `;
            document.getElementById('result1').style.display = 'block';
        }
        
        function setEncryptedText1() {
            document.getElementById('testText1').value = generateEncryptedText('å¼ ä¼Ÿæ˜', 1);
            testIsEncrypted();
        }
        
        // ç¤ºä¾‹ 2: æ›¿æ¢
        function testReplace() {
            const text = document.getElementById('testText2').value;
            const replacement = document.getElementById('replacement').value || '*';
            const result = UniMaskUtils.replaceEncryptedWithAsterisk(text, replacement);
            
            document.getElementById('resultContent2').innerHTML = `
                <div><strong>åŸæ–‡ï¼š</strong>${text}</div>
                <div style="margin-top: 10px;"><strong>æ›¿æ¢åï¼š</strong>${result}</div>
            `;
            document.getElementById('result2').style.display = 'block';
        }
        
        function setEncryptedText2() {
            document.getElementById('testText2').value = generateEncryptedText('å¼ ä¼Ÿæ˜', 1);
            testReplace();
        }
        
        // ç¤ºä¾‹ 3: åˆ†æ
        function testAnalyze() {
            const text = document.getElementById('testText3').value;
            const analysis = UniMaskUtils.analyzeText(text);
            
            let positionsHtml = '';
            if (analysis.positions.length > 0) {
                positionsHtml = '<div style="margin-top: 10px;"><strong>åŠ å¯†å­—ç¬¦ä½ç½®ï¼š</strong></div>';
                analysis.positions.forEach(pos => {
                    positionsHtml += `<div>ä½ç½® ${pos.index}: ${pos.codePoint}</div>`;
                });
            }
            
            document.getElementById('resultContent3').innerHTML = `
                <div><strong>æ˜¯å¦åŠ å¯†ï¼š</strong>${analysis.isEncrypted ? 'æ˜¯' : 'å¦'}</div>
                <div><strong>æ€»å­—ç¬¦æ•°ï¼š</strong>${analysis.totalChars}</div>
                <div><strong>åŠ å¯†å­—ç¬¦ï¼š</strong>${analysis.encryptedChars}</div>
                <div><strong>æ˜æ–‡å­—ç¬¦ï¼š</strong>${analysis.plainChars}</div>
                <div><strong>åŠ å¯†ç‡ï¼š</strong>${analysis.encryptionRate}</div>
                ${positionsHtml}
            `;
            document.getElementById('result3').style.display = 'block';
        }
        
        function setEncryptedText3() {
            document.getElementById('testText3').value = generateEncryptedText('å¼ ä¼Ÿæ˜', 1);
            testAnalyze();
        }
        
        // ç¤ºä¾‹ 4: å¯¹è±¡å¤„ç†
        function testObjectReplace() {
            const user = {
                id: 1,
                name: generateEncryptedText('å¼ ä¼Ÿæ˜', 1),
                phone: generateEncryptedText('13812345678', 3),
                email: "test@example.com"
            };
            
            const processed = UniMaskUtils.replaceFieldsInObject(user, ['name', 'phone']);
            
            document.getElementById('resultContent4').innerHTML = `
                <div><strong>åŸå§‹å¯¹è±¡ï¼š</strong></div>
                <pre>${JSON.stringify(user, null, 2)}</pre>
                <div style="margin-top: 15px;"><strong>å¤„ç†åå¯¹è±¡ï¼š</strong></div>
                <pre>${JSON.stringify(processed, null, 2)}</pre>
            `;
            document.getElementById('result4').style.display = 'block';
        }
        
        // ç¤ºä¾‹ 5: æ•°ç»„å¤„ç†
        function testArrayReplace() {
            const users = [
                { id: 1, name: generateEncryptedText('å¼ ä¼Ÿ', 1), age: 25, phone: generateEncryptedText('13812345678', 3) },
                { id: 2, name: generateEncryptedText('ææ˜', 1), age: 30, phone: generateEncryptedText('13987654321', 3) },
                { id: 3, name: generateEncryptedText('ç‹èŠ³', 1), age: 28, phone: generateEncryptedText('13698745632', 3) }
            ];
            
            const processed = UniMaskUtils.replaceFieldsInArray(users, ['name', 'phone']);
            
            // æ˜¾ç¤ºåŸå§‹è¡¨æ ¼
            let originalHtml = '<tr><th>ID</th><th>å§“å</th><th>å¹´é¾„</th><th>ç”µè¯</th></tr>';
            users.forEach(user => {
                originalHtml += `<tr><td>${user.id}</td><td>${user.name}</td><td>${user.age}</td><td>${user.phone}</td></tr>`;
            });
            document.getElementById('originalTable').innerHTML = originalHtml;
            
            // æ˜¾ç¤ºå¤„ç†åè¡¨æ ¼
            let processedHtml = '<tr><th>ID</th><th>å§“å</th><th>å¹´é¾„</th><th>ç”µè¯</th></tr>';
            processed.forEach(user => {
                processedHtml += `<tr><td>${user.id}</td><td>${user.name}</td><td>${user.age}</td><td>${user.phone}</td></tr>`;
            });
            document.getElementById('processedTable').innerHTML = processedHtml;
            
            document.getElementById('result5').style.display = 'block';
        }
        
        // ç¤ºä¾‹ 6: å¯¼å‡ºæ ¼å¼
        function testExportFormat(preserveLength) {
            const text = document.getElementById('testText6').value;
            const lines = text.split('\n');
            const results = lines.map(line => 
                UniMaskUtils.toExportFormat(line, { preserveLength })
            );
            
            document.getElementById('resultContent6').innerHTML = `
                <div><strong>æ¨¡å¼ï¼š</strong>${preserveLength ? 'ä¿æŒé•¿åº¦' : 'åˆå¹¶æ˜Ÿå·'}</div>
                <div style="margin-top: 10px;"><strong>åŸæ–‡ï¼š</strong></div>
                <pre>${text}</pre>
                <div style="margin-top: 10px;"><strong>è½¬æ¢åï¼š</strong></div>
                <pre>${results.join('\n')}</pre>
            `;
            document.getElementById('result6').style.display = 'block';
        }
        
        function setEncryptedText6() {
            const examples = [
                generateEncryptedText('å¼ ä¼Ÿæ˜', 1),
                generateEncryptedText('æçº¢', 1),
                generateEncryptedText('ç‹å»ºå›½', 1)
            ];
            document.getElementById('testText6').value = examples.join('\n');
            testExportFormat(true);
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹
        window.onload = function() {
            console.log('%câœ… UniMaskUtils å·¥å…·å·²åŠ è½½', 'color: green; font-weight: bold; font-size: 14px;');
            console.log('Unicode åŒºåŸŸé…ç½®:', UniMaskUtils.REGIONS);
            
            // è®¾ç½®åˆå§‹ç¤ºä¾‹
            setEncryptedText1();
        };
    </script>
</body>
</html>
